<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>⚽ 出欠管理</title>

<!-- html2pdf -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>
body{
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  background:#f5f7fb;
  margin:0;
  padding:12px;
}

header{
  display:flex;
  align-items:center;
  gap:8px;
  margin-bottom:8px;
}

button{
  padding:6px 10px;
  font-size:13px;
}

#monthLabel{
  font-weight:bold;
}

/* ===== 表 ===== */
table{
  border-collapse:collapse;
  background:#fff;
  font-size:12px;
}
th,td{
  border:1px solid #ccc;
  padding:4px;
  text-align:center;
  min-width:28px;
}

th.no, td.no{
  position:sticky;
  left:0;
  background:#e9f1ff;
  z-index:3;
}
th.name, td.name{
  position:sticky;
  left:36px;
  background:#e9f1ff;
  z-index:3;
  min-width:80px;
  text-align:left;
  padding-left:6px;
}

/* ===== 出席率 ===== */
#stats{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  margin-top:10px;
}
.statsCard{
  background:#fff;
  border:1px solid #ccc;
  padding:6px 8px;
  font-size:12px;
  width:180px;
}

/* ===== PDF用 ===== */
#pdfRoot{
  position:relative;
  background:#fff;
  padding:16px;
}

/* ロゴ透かし */
.pdf-watermark{
  position:absolute;
  top:50%;
  left:50%;
  width:60%;
  max-width:420px;
  transform:translate(-50%,-50%);
  opacity:0.06;
  pointer-events:none;
  z-index:0;
}

#pdfRoot > *:not(.pdf-watermark){
  position:relative;
  z-index:1;
}

/* 表紙 */
.pdf-title{
  font-size:20px;
  font-weight:bold;
  margin-bottom:4px;
}
.pdf-month{
  font-size:14px;
  margin-bottom:12px;
}

/* 凡例（2行） */
.legend{
  font-size:12px;
  margin:8px 0;
}
.legend-line{
  display:flex;
  gap:14px;
  flex-wrap:wrap;
}

/* 補足（上品版） */
.note{
  margin-top:10px;
  padding-top:6px;
  border-top:1px dashed #ccc;
  font-size:11px;
  color:#555;
}
.note-title{
  font-weight:bold;
  margin-bottom:2px;
}
</style>
</head>

<body>

<header>
  <button id="prevMonth">◀</button>
  <span id="monthLabel"></span>
  <button id="nextMonth">▶</button>

  <button onclick="exportPDF()">月まとめPDF</button>
  <button onclick="exportCSV()">CSV</button>
</header>

<!-- ===== PDF対象 ===== -->
<div id="pdfRoot">

  <!-- 透かしロゴ（画像パスだけ合わせてください） -->
  <img src="./logo.png" class="pdf-watermark">

  <!-- 表紙 -->
  <div class="pdf-title">⚽ 出欠管理</div>
  <div class="pdf-month" id="pdfMonth"></div>

  <!-- 凡例（2行） -->
  <div class="legend">
    <div class="legend-line">
      <span>○：出席</span>
      <span>×：欠席</span>
      <span>－：未入力</span>
    </div>
    <div class="legend-line">
      <span>※：トレセン</span>
      <span>◻︎：学校行事</span>
    </div>
  </div>

  <!-- 表 -->
  <table id="table"></table>

  <!-- 出席率 -->
  <div id="stats"></div>

  <!-- 補足 -->
  <div class="note">
    <div class="note-title">⭐ 補足</div>
    トレセンおよび学校行事は、出席率の算出対象外としています。
  </div>

</div>

<!-- main.js（既存のまま） -->
<script type="module" src="./main.js"></script>

<script>
function exportPDF(){
  const month = document.getElementById("monthLabel").innerText;
  document.getElementById("pdfMonth").innerText = month;

  const el = document.getElementById("pdfRoot");
  html2pdf()
    .set({
      margin:8,
      filename: month.replace(/\s/g,"") + "_出欠管理.pdf",
      image:{ type:"jpeg", quality:0.98 },
      html2canvas:{ scale:2, backgroundColor:"#ffffff" },
      jsPDF:{ unit:"mm", format:"a4", orientation:"portrait" }
    })
    .from(el)
    .save();
}
</script>

</body>
</html>
